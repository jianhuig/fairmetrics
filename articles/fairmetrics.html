<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Binary Protected Attributes • fairmetrics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Binary Protected Attributes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fairmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/fairmetrics.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="fairmetrics_files/kePrint-0.0.1/kePrint.js"></script><link href="fairmetrics_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Binary Protected Attributes</h1>
            
      

      <div class="d-none name"><code>fairmetrics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We illustrate the usage of the <code>fairmetrics</code> package
through a case study using a publicly available dataset of 1,776 ICU
patients from the MIMIC-II clinical database, focusing on predicting
28-day mortality and evaluating disparities in model performance across
sex.</p>
<p>The following packages are used for the analysis along with the
<code>fairmetrics</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Packages we are using for the analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/" class="external-link">pROC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SpecsVerification</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/naniar" class="external-link">naniar</a></span><span class="op">)</span></span>
<span><span class="co"># Our package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jianhuig.github.io/fairmetrics/" class="external-link">fairmetrics</a></span><span class="op">)</span></span></code></pre></div>
<p>The “Data Preprocessing” section discusses the dataset, the handling
of missing data, model construction and standard predictive model
evaluation through train-test splitting for binary classification. The
“Fairness Evaluation” section shows how to evaluate the model’s fairness
toward binary protected attributes with the <code>fairmetrics</code>
package.</p>
<!--
Finally, the “Practical Considerations” section discusses the inherent trade-offs between different fairness definitions in clinical settings and highlights the challenges of enforcing fairness when outcome prevalence differs across groups. Details regarding the construction of 95% confidence intervals are provided in the appendix.
--->
</div>
<div class="section level2">
<h2 id="data-preprocessing">Data Preprocessing<a class="anchor" aria-label="anchor" href="#data-preprocessing"></a>
</h2>
<p>The dataset used in this analysis is the MIMIC II clinical database
[2], which has been previously studied to explore the relationship
between indwelling arterial catheters in hemodynamically stable patients
and respiratory failure in relation to mortality outcomes [3]. It
includes 46 variables which cover demographics and clinical
characteristics (including white blood cell count, heart rate during ICU
stays and others) along with a 28-day mortality indicator
(<code>day_28_flg</code>) for 1,776 patients. The data has been made
publicly available by <a href="https://physionet.org/content/mimic2-iaccd/1.0/" class="external-link">PhysioNet</a> [4]
and is available in the <code>fairmetrics</code> package as the
<code>mimic</code> dataset.</p>
<div class="section level3">
<h3 id="handling-missing-data">Handling Missing Data<a class="anchor" aria-label="anchor" href="#handling-missing-data"></a>
</h3>
<p>We first assess the extent of missingness in the dataset. For each
variable, we calculate both the total number and the percentage of
missing values with <code><a href="https://naniar.njtierney.com/reference/miss_var_summary.html" class="external-link">naniar::miss_var_summary()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loading mimic dataset </span></span>
<span><span class="co"># (available in fairmetrics)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mimic"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">missing_data_summary</span><span class="op">&lt;-</span> <span class="fu">naniar</span><span class="fu">::</span><span class="fu"><a href="https://naniar.njtierney.com/reference/miss_var_summary.html" class="external-link">miss_var_summary</a></span><span class="op">(</span><span class="va">mimic</span>, digits<span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">missing_data_summary</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span></span>
<span>    latex_options <span class="op">=</span> <span class="st">"hold_position"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
n_miss
</th>
<th style="text-align:right;">
pct_miss
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
bmi
</td>
<td style="text-align:right;">
466
</td>
<td style="text-align:right;">
26.239
</td>
</tr>
<tr>
<td style="text-align:left;">
po2_first
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
10.473
</td>
</tr>
<tr>
<td style="text-align:left;">
pco2_first
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
10.473
</td>
</tr>
<tr>
<td style="text-align:left;">
iv_day_1
</td>
<td style="text-align:right;">
143
</td>
<td style="text-align:right;">
8.052
</td>
</tr>
<tr>
<td style="text-align:left;">
weight_first
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
6.194
</td>
</tr>
<tr>
<td style="text-align:left;">
sapsi_first
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
4.786
</td>
</tr>
<tr>
<td style="text-align:left;">
wbc_first
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.450
</td>
</tr>
<tr>
<td style="text-align:left;">
hgb_first
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.450
</td>
</tr>
<tr>
<td style="text-align:left;">
platelet_first
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.450
</td>
</tr>
<tr>
<td style="text-align:left;">
sofa_first
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.338
</td>
</tr>
<tr>
<td style="text-align:left;">
creatinine_first
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.338
</td>
</tr>
<tr>
<td style="text-align:left;">
sodium_first
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
potassium_first
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
tco2_first
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
chloride_first
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
bun_first
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
temp_1st
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.169
</td>
</tr>
<tr>
<td style="text-align:left;">
gender_num
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.056
</td>
</tr>
<tr>
<td style="text-align:left;">
aline_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
icu_los_day
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
hospital_los_day
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
service_unit
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
service_num
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
day_icu_intime
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
day_icu_intime_num
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
hour_icu_intime
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
hosp_exp_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
icu_exp_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
day_28_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
mort_day_censored
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
censor_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
sepsis_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
chf_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
afib_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
renal_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
liver_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
copd_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
cad_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
stroke_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
mal_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
resp_flg
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
map_1st
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
hr_1st
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
spo2_1st
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
abg_count
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
</tbody>
</table>
<p>To ensure data quality, the following procedure is applied to handle
missing data:</p>
<ul>
<li><p>Removal of that variables which had more than 10% missing values.
Three variables had more than 10% of missing values: body mass index
(<code>bmi</code>; 26.2%), first partial pressure of oxygen
(<code>po2_first</code>; 10.5%), and first partial pressure of carbon
dioxide (<code>pco2_first</code>; 10.5%).</p></li>
<li><p>Remaining missing values are imputed using the median value of
the variable which they belong to.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove columns with more than 10% missing values</span></span>
<span><span class="va">columns_to_remove</span> <span class="op">&lt;-</span> <span class="va">missing_data_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pct_miss</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">mimic</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mimic</span>, </span>
<span>                       <span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html" class="external-link">one_of</a></span><span class="op">(</span><span class="va">columns_to_remove</span><span class="op">)</span></span>
<span>                       <span class="op">)</span></span>
<span></span>
<span><span class="co"># Impute remaining missing values with median</span></span>
<span><span class="va">mimic</span> <span class="op">&lt;-</span> <span class="va">mimic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>We additionally remove <code>sepsis_flg</code> column from the
dataset as it contains a single unique value across all observations.
Since this does not provide any useful information for model training,
it is excluded.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify columns that have only one unique value</span></span>
<span><span class="va">cols_with_one_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mimic</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Subset the dataframe to remove these columns</span></span>
<span><span class="va">mimic</span> <span class="op">&lt;-</span> <span class="va">mimic</span><span class="op">[</span>, <span class="op">!</span><span class="va">cols_with_one_value</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-building">Model Building<a class="anchor" aria-label="anchor" href="#model-building"></a>
</h3>
<p>Before training the model, we further remove variables that are
directly correlated with patient outcomes to prevent <a href="https://en.wikipedia.org/wiki/Leakage_%28machine_learning%29" class="external-link">data
leakage</a>. In particular, we inspect the correlation matrix of the
numeric features and exclude variables such as the hospital expiration
flag (<code>hosp_exp_flg</code>), the ICU expiration flag
(<code>icu_exp_flg</code>), the mortality censoring day
(<code>mort_day_censored</code>), and the censoring flag
(<code>censor_flg</code>), which are strongly associated patient
outcomes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove columns that are highly correlated with the outcome variable</span></span>
<span><span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="va">mimic</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"color"</span>, tl.cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="fairmetrics_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mimic</span> <span class="op">&lt;-</span> <span class="va">mimic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hosp_exp_flg"</span>, <span class="st">"icu_exp_flg"</span>, <span class="st">"mort_day_censored"</span>, <span class="st">"censor_flg"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We split the dataset into a training and testing sets. The first 700
patients are used as the training set and the remaining patients are
used as the testing set. The hyperparameters for the random forest (RF)
model are set to use 1000 trees and a random sampling of 6 variables at
each split, determined by the square root of the number of predictors.
After training, the overall area under the receiver operating
characteristic curve (AUC) for the model on the test set is 0.90 and the
overall accuracy of the model on the test set is 0.88.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use 700 labels to train the mimic</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">mimic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">700</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a random forest model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">day_28_flg</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, ntree <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test the model on the remaining data</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">mimic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">700</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check the AUC</span></span>
<span><span class="va">roc_obj</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">day_28_flg</span>, <span class="va">test_data</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting levels: control = 0, case = 1</span></span>
<span><span class="co">#&gt; Setting direction: controls &lt; cases</span></span>
<span><span class="va">roc_auc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc_obj</span><span class="op">)</span></span>
<span><span class="va">roc_auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.8971</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fairness-evaluation">Fairness Evaluation<a class="anchor" aria-label="anchor" href="#fairness-evaluation"></a>
</h2>
<p>To evaluate fairness, we use the testing set results to examine
patient gender as a binary protected attribute and 28-day mortality
(<code>day_28_flg</code>) as the outcome of interest.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recode gender variable explicitly for readability: </span></span>
<span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">test_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">gender_num</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since many fairness metrics require binary predictions, we threshold
the predicted probabilities using a fixed cutoff. We set a threshold of
0.41 to maintain the overall false positive rate (FPR) at approximately
5%.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Control the overall false positive rate (FPR) at 5% by setting a threshold.</span></span>
<span></span>
<span><span class="va">cut_off</span> <span class="op">&lt;-</span> <span class="fl">0.41</span></span>
<span></span>
<span><span class="va">test_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pred</span> <span class="op">&gt;</span> <span class="va">cut_off</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">day_28_flg</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fpr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          fpr</span></span>
<span><span class="co">#&gt; 1 0.05054945</span></span></code></pre></div>
<p>To calculate various fairness metrics for the model, we pass our test
data with its predicted results into the
<code>get_fairness_metrics</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fairness_result</span> <span class="op">&lt;-</span> <span class="fu">fairmetrics</span><span class="fu">::</span><span class="fu"><a href="../reference/get_fairness_metrics.html">get_fairness_metrics</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">test_data</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"day_28_flg"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>  group2 <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"&gt;=60"</span>,</span>
<span>  probs <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="va">cut_off</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">fairness_result</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html" class="external-link">pack_rows</a></span><span class="op">(</span><span class="st">"Independence-based criteria"</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html" class="external-link">pack_rows</a></span><span class="op">(</span><span class="st">"Separation-based criteria"</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html" class="external-link">pack_rows</a></span><span class="op">(</span><span class="st">"Sufficiency-based criteria"</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html" class="external-link">pack_rows</a></span><span class="op">(</span><span class="st">"Other criteria"</span>, <span class="fl">9</span>, <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span></span>
<span>    full_width <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    font_size <span class="op">=</span> <span class="fl">10</span>,         <span class="co"># Controls font size manually</span></span>
<span>    latex_options <span class="op">=</span> <span class="st">"hold_position"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table class="table table table" style="width: auto !important; margin-left: auto; margin-right: auto; font-size: 10px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:left;">
Full Metric Name
</th>
<th style="text-align:right;">
GroupFemale
</th>
<th style="text-align:right;">
GroupMale
</th>
<th style="text-align:right;">
Difference
</th>
<th style="text-align:left;">
95% Diff CI
</th>
<th style="text-align:right;">
Ratio
</th>
<th style="text-align:left;">
95% Ratio CI
</th>
</tr></thead>
<tbody>
<tr grouplength="2">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Independence-based criteria</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
PPR
</td>
<td style="text-align:left;">
Statistical Parity
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:left;">
[0.05, 0.13]
</td>
<td style="text-align:right;">
2.12
</td>
<td style="text-align:left;">
[1.48, 3.05]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
PPR
</td>
<td style="text-align:left;">
Conditional Statistical Parity (age &gt;=60)
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:left;">
[0.05, 0.21]
</td>
<td style="text-align:right;">
1.62
</td>
<td style="text-align:left;">
[1.18, 2.22]
</td>
</tr>
<tr grouplength="4">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Separation-based criteria</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
FNR
</td>
<td style="text-align:left;">
Equal Opportunity
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
-0.24
</td>
<td style="text-align:left;">
[-0.39, -0.09]
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:left;">
[0.44, 0.86]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
FPR
</td>
<td style="text-align:left;">
Predictive Equality
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
[0.02, 0.08]
</td>
<td style="text-align:right;">
2.67
</td>
<td style="text-align:left;">
[1.39, 5.1]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Avg. Predicted Prob.
</td>
<td style="text-align:left;">
Balance for Positive Class
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:left;">
[0.04, 0.14]
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:left;">
[1.09, 1.41]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Avg. Predicted Prob.
</td>
<td style="text-align:left;">
Balance for Negative Class
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
[0.03, 0.07]
</td>
<td style="text-align:right;">
1.50
</td>
<td style="text-align:left;">
[1.29, 1.74]
</td>
</tr>
<tr grouplength="2">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Sufficiency-based criteria</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
PPV
</td>
<td style="text-align:left;">
Positive Predictive Parity
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:left;">
[-0.21, 0.13]
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:left;">
[0.72, 1.23]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
NPV
</td>
<td style="text-align:left;">
Negative Predictive Parity
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:left;">
[-0.15, 0.19]
</td>
<td style="text-align:right;">
1.02
</td>
<td style="text-align:left;">
[0.79, 1.33]
</td>
</tr>
<tr grouplength="3">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Other criteria</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Brier Score
</td>
<td style="text-align:left;">
Brier Score Parity
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:left;">
[-0.01, 0.03]
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:left;">
[0.88, 1.43]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Accuracy
</td>
<td style="text-align:left;">
Overall Accuracy Parity
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
0.88
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:left;">
[-0.05, 0.03]
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:left;">
[0.94, 1.04]
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
FN/FP Ratio
</td>
<td style="text-align:left;">
Treatment Equality
</td>
<td style="text-align:right;">
1.03
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
-2.21
</td>
<td style="text-align:left;">
[-4.5, 0.08]
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:left;">
[0.15, 0.69]
</td>
</tr>
</tbody>
</table>
<p>From the outputted fairness metrics we note:</p>
<ul>
<li><p>Independence is likely violated, as evidenced by the statistical
parity metric which shows a 9% difference (95% CI: [5%, 13%]) or a ratio
of 2.12 (95% CI: [1.49, 3.04]) between females and males. The measures
in the independence category indicate that the model predicts a
significantly higher mortality rate for females, even after conditioning
on age.</p></li>
<li><p>With respect to separation, we observe that all metrics show
significant disparities. For instance, equal opportunity shows a -24%
difference (95% CI: [-39%, -9%]) in false negative rate (FNR) between
females and males. This indicates the model is less likely to detect
males at risk of mortality compared to females.</p></li>
<li><p>On the other hand, the sufficiency criterion is satisfied as
predictive parity shows no significant difference between males and
females (difference: -4%, 95% CI: [-21%, 13%]; ratio: 0.94, 95% CI:
[0.72, 1.23]). This suggests that given the same prediction, the actual
mortality rates are similar for both males and females.</p></li>
<li><p>Among the additional metrics that assess calibration and
discrimination, Brier Score Parity and Overall Accuracy Equality do not
show significant disparities. However, Treatment Equality shows a
statistically significant difference (difference: –2.21, 95% CI: [–4.35,
–0.07]; ratio: 0.32, 95% CI: [0.15, 0.68]), indicating that males have a
substantially higher false negative to false positive ratio compared to
females. This suggests that male patients are more likely to be missed
by the model relative to being incorrectly flagged.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="appendix-a-confidence-interval-construction">Appendix A: Confidence Interval Construction<a class="anchor" aria-label="anchor" href="#appendix-a-confidence-interval-construction"></a>
</h2>
<p>The function <code><a href="../reference/get_fairness_metrics.html">get_fairness_metrics()</a></code> computes Wald-type
confidence intervals for both group-specific and disparity metrics using
nonparametric bootstrap. To illustrate the construction of confidence
intervals (CIs), we use the following example involving the false
positive rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>P</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">FPR</annotation></semantics></math>).</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><mi>a</mi></msub><annotation encoding="application/x-tex">\widehat{\textrm{FPR}}_a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">FPR</mtext><mi>a</mi></msub><annotation encoding="application/x-tex">\textrm{FPR}_a</annotation></semantics></math>
denote the estimated and true FPR in group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">A = a</annotation></semantics></math>.
Then the difference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>=</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>1</mn></msub></msub><mo>−</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>0</mn></msub></msub></mrow><annotation encoding="application/x-tex">\widehat{\Delta}_{\textrm{FPR}} = \widehat{\textrm{FPR}}_{a_1} - \widehat{\textrm{FPR}}_{a_0}</annotation></semantics></math>
satisfies (e.g., <a href="https://doi.org/10.1093/jrsssb/qkad107" class="external-link">Gronsbell et al.,
2018</a>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mi>n</mi></msqrt><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>−</mo><msub><mi>Δ</mi><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mover><mo>→</mo><mi>d</mi></mover><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\sqrt{n}(\widehat{\Delta}_{\textrm{FPR}} - \Delta_{\textrm{FPR}}) \overset{d}{\to} \mathcal{N}(0, \sigma^2)
</annotation></semantics></math></p>
<p>We estimate the standard error of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><annotation encoding="application/x-tex">\widehat{\Delta}_{\textrm{FPR}}</annotation></semantics></math>
using bootstrap resampling within groups, and form a Wald-style
confidence interval:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>±</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\widehat{\Delta}_{\textrm{FPR}} \pm z_{1-\alpha/2} \cdot \widehat{\textrm{se}}(\widehat{\Delta}_{\textrm{FPR}})
</annotation></semantics></math></p>
<p>For <strong>ratios</strong>, such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>=</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>1</mn></msub></msub><mi>/</mi><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>0</mn></msub></msub></mrow><annotation encoding="application/x-tex">\widehat{\rho}_{\textrm{FPR}} = \widehat{\textrm{FPR}}_{a_1} / \widehat{\textrm{FPR}}_{a_0}</annotation></semantics></math>,
we apply a log transformation and use the delta method:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>±</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\log(\widehat{\rho}_{\textrm{FPR}}) \pm z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]
</annotation></semantics></math></p>
<p>Exponentiation of the bounds yields a confidence interval for the
ratio on the original scale:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\left[ 
\exp\left\{\log(\widehat{\rho}_{\textrm{FPR}}) - z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]\right\},\ 
\exp\left\{\log(\widehat{\rho}_{\textrm{FPR}}) + z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]\right\}
\right].
</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="appendix-b-practical-fairness-considerations">Appendix B: Practical Fairness Considerations<a class="anchor" aria-label="anchor" href="#appendix-b-practical-fairness-considerations"></a>
</h2>
<p>In the above example, both <strong>separation</strong> and
<strong>sufficiency</strong>-based fairness criteria are important:</p>
<ul>
<li>
<strong>Separation</strong> ensures that patients at true risk are
identified across groups, reducing under-detection in specific
sub-populations.</li>
<li>
<strong>Sufficiency</strong> ensures interventions are based solely
on predicted need, not protected attributes.</li>
</ul>
<p>However, 28-day mortality differs by sex (19% for females vs. 14% for
males), making it impossible to satisfy multiple fairness criteria
simultaneously.</p>
<p>Given this, enforcing <strong>independence</strong> is likely not
advisable in this case, as it could blind the model to true mortality
differences. However, the model <strong>violates separation</strong>,
potentially leading to higher false negative rates among male patients
and delayed interventions.</p>
<p>See <a href="https://arxiv.org/abs/2207.07068" class="external-link">Hort et al. (2022)</a>
for strategies to reduce disparities in separation-based metrics.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Gao, J. et al. What is Fair? Defining Fairness in Machine
Learning for Health. arXiv.org <a href="https://arxiv.org/abs/2406.09307" class="external-link uri">https://arxiv.org/abs/2406.09307</a> (2024).</p></li>
<li><p>Raffa, J. (2016). Clinical data from the MIMIC-II database for a
case study on indwelling arterial catheters (version 1.0). PhysioNet. <a href="https://doi.org/10.13026/C2NC7F" class="external-link uri">https://doi.org/10.13026/C2NC7F</a>.</p></li>
<li><p>Raffa J.D., Ghassemi M., Naumann T., Feng M., Hsu D. (2016) Data
Analysis. In: Secondary Analysis of Electronic Health Records. Springer,
Cham</p></li>
<li><p>Goldberger, A., Amaral, L., Glass, L., Hausdorff, J., Ivanov, P.
C., Mark, R., … &amp; Stanley, H. E. (2000). PhysioBank, PhysioToolkit,
and PhysioNet: Components of a new research resource for complex
physiologic signals. Circulation [Online]. 101 (23),
pp. e215–e220.</p></li>
<li><p>Hsu, D. J. et al. The association between indwelling arterial
catheters and mortality in hemodynamically stable patients with
respiratory failure. CHEST Journal 148, 1470–1476 (2015).</p></li>
<li><p>Gronsbell, J. L. &amp; Cai, T. Semi-Supervised approaches to
efficient evaluation of model prediction performance. Journal of the
Royal Statistical Society Series B (Statistical Methodology) 80, 579–594
(2017).</p></li>
<li><p>Efron, B. &amp; Tibshirani, R. Bootstrap methods for standard
errors, confidence intervals, and other measures of statistical
accuracy. Statistical Science 1, (1986).</p></li>
<li><p>Hort, M., Chen, Z., Zhang, J. M., Harman, M. &amp; Sarro, F. Bias
Mitigation for Machine Learning Classifiers: A Comprehensive survey.
arXiv.org <a href="https://arxiv.org/abs/2207.07068" class="external-link uri">https://arxiv.org/abs/2207.07068</a> (2022).</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jianhui Gao, Benjamin Smith, Benson Chou, Jessica Gronsbell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

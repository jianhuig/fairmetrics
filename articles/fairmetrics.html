<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing Model Fairness Across Binary Protected Attributes • fairmetrics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing Model Fairness Across Binary Protected Attributes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fairmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/fairmetrics.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Assessing Model Fairness Across Binary Protected Attributes</h1>
            
      

      <div class="d-none name"><code>fairmetrics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vingette demonstrates how to obtain, report and interpret model
fairness metrics for binary protected attributes with the
<code>fairmetrics</code> package. We illustrate this through a case
study based on a preprocessed version of the MIMIC-II clinical database
[1], which has been previously studied to explore the relationship
between indwelling arterial catheters in hemodynamically stable patients
and respiratory failure in relation to mortality outcomes [2]. The
original, unprocessed dataset is publicly available through <a href="https://physionet.org/content/mimic2-iaccd/1.0/" class="external-link">PhysioNet</a>
[3]. A preprocessed version of this dataset is included in the
<code>fairmetrics</code> package as the <code>mimic_preprocessed</code>
and is used in this vingette.</p>
</div>
<div class="section level2">
<h2 id="data-split-and-model-construction">Data Split and Model Construction<a class="anchor" aria-label="anchor" href="#data-split-and-model-construction"></a>
</h2>
<p>In this setting, we construct a model that will predict 28-day
mortality (<code>day_28_flg</code>). To do this, we split the dataset
into a training and testing sets and fit a random forest model. The
first 700 patients are used as the training set and the remaining
patients are used as the testing set. After the model is fit, it is used
to predict 28-day mortality. The predicted probabilities are saved as
new column in the testing data and are used to assess model
fairness.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jianhuig.github.io/fairmetrics/" class="external-link">fairmetrics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Use 700 labels to train on the mimic_preprocessed dataset</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">mimic_preprocessed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">700</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test the model on the remaining data</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">mimic_preprocessed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">700</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a random forest model</span></span>
<span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">day_28_flg</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, ntree <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co"># Save model prediction</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fairness-evaluation">Fairness Evaluation<a class="anchor" aria-label="anchor" href="#fairness-evaluation"></a>
</h2>
<p>The <code>fairmetrics</code> package is used to assess model fairness
across binary protected attributes. This means that the number of unique
values in the protected attribute column need to be exactly two. To
evaluate fairness of the random forest model which we fit, we examine
patient gender as the binary protected attribute.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recode gender variable explicitly for readability: </span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">test_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">gender_num</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since many fairness metrics require binary predictions, we threshold
the predicted probabilities using a fixed cutoff. We set a threshold of
0.41 to maintain the overall false positive rate (FPR) at approximately
5%. To evaluate specific fairness metrics, its possible to do so with
the <code>eval_*</code> functions (for a list of the functions contained
in <code>fairmetrics</code> see <a href="https://jianhuig.github.io/fairmetrics/reference/index.html" class="external-link">here</a>).
For example, if we are interested in calculating the statistical parity
of our model across gender (here assumed to be binary), we write:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eval_stats_parity.html">eval_stats_parity</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">test_data</span>, </span>
<span>  outcome <span class="op">=</span> <span class="st">"day_28_flg"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>  probs <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.41</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; There is evidence that model does not satisfy statistical parity.</span></span>
<span><span class="co">#&gt;                     Metric GroupFemale GroupMale Difference  95% Diff CI Ratio</span></span>
<span><span class="co">#&gt; 1 Positive Prediction Rate        0.17      0.09       0.08 [0.04, 0.12]  1.89</span></span>
<span><span class="co">#&gt;   95% Ratio CI</span></span>
<span><span class="co">#&gt; 1 [1.35, 2.64]</span></span></code></pre></div>
<p>The dataframe returned gives the positive prediction rate between the
groups defined by the binary protected attribute
(<code>GroupFemale</code> and <code>GroupMale</code> in this case), the
difference and ratios between the groups and the bootstrap calculated
confidence intervals for the estimated difference and ratios. For
inference, it can be considered that confidence interval which contains
0 in its range for difference or 1 for ratio as insignificant.</p>
<p>The above syntax can be extended to the other <code>eval_*</code>
functions as well. Additionally, if one wishes to calculate various
fairness metrics (and their confidence intervals) for the model
simultaneously, we pass our test data with its predicted results into
the <code>get_fairness_metrics</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_fairness_metrics.html">get_fairness_metrics</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">test_data</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"day_28_flg"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>  probs <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.41</span></span>
<span> <span class="op">)</span></span>
<span><span class="co">#&gt;            Fairness Assesment                                  Metric</span></span>
<span><span class="co">#&gt; 1          Statistical Parity                Positive Prediction Rate</span></span>
<span><span class="co">#&gt; 2           Equal Opportunity                     False Negative Rate</span></span>
<span><span class="co">#&gt; 3         Predictive Equality                     False Positive Rate</span></span>
<span><span class="co">#&gt; 4  Balance for Positive Class           Avg. Predicted Positive Prob.</span></span>
<span><span class="co">#&gt; 5  Balance for Negative Class           Avg. Predicted Negative Prob.</span></span>
<span><span class="co">#&gt; 6  Positive Predictive Parity               Positive Predictive Value</span></span>
<span><span class="co">#&gt; 7  Negative Predictive Parity               Negative Predictive Value</span></span>
<span><span class="co">#&gt; 8          Brier Score Parity                             Brier Score</span></span>
<span><span class="co">#&gt; 9     Overall Accuracy Parity                                Accuracy</span></span>
<span><span class="co">#&gt; 10         Treatment Equality (False Negative)/(False Positive) Ratio</span></span>
<span><span class="co">#&gt;    GroupFemale GroupMale Difference    95% Diff CI Ratio 95% Ratio CI</span></span>
<span><span class="co">#&gt; 1         0.17      0.09       0.08   [0.04, 0.12]  1.89 [1.35, 2.64]</span></span>
<span><span class="co">#&gt; 2         0.38      0.57      -0.19 [-0.34, -0.04]  0.67 [0.47, 0.94]</span></span>
<span><span class="co">#&gt; 3         0.08      0.03       0.05   [0.02, 0.08]  2.67  [1.4, 5.08]</span></span>
<span><span class="co">#&gt; 4         0.46      0.37       0.09   [0.04, 0.14]  1.24 [1.09, 1.42]</span></span>
<span><span class="co">#&gt; 5         0.15      0.11       0.04   [0.02, 0.06]  1.36 [1.17, 1.59]</span></span>
<span><span class="co">#&gt; 6         0.62      0.68      -0.06  [-0.23, 0.11]  0.91 [0.71, 1.18]</span></span>
<span><span class="co">#&gt; 7         0.92      0.91       0.01  [-0.03, 0.05]  1.01 [0.97, 1.05]</span></span>
<span><span class="co">#&gt; 8         0.09      0.08       0.01  [-0.01, 0.03]  1.12 [0.88, 1.43]</span></span>
<span><span class="co">#&gt; 9         0.87      0.89      -0.02  [-0.06, 0.02]  0.98 [0.93, 1.02]</span></span>
<span><span class="co">#&gt; 10        1.03      2.78      -1.75    [-3.6, 0.1]  0.37 [0.17, 0.79]</span></span></code></pre></div>
<p>With the <code>get_fairness_metrics</code> function, it’s possible to
examine the bootstrapped confidence intervals to determine which
fairness criterion show evidence of violation. From the above output,
Statistical Parity, Equal Opportunity, Predictive Equality, Balance for
Positive Class and Balance for Negative Class show evidence of being
violated, while Positive Predictive Parity, Negative Predictive Parity,
Brier Score Parity and Overall Accuracy Parity do not. Treatment
Equality remains ambiguous: when assessed by difference, the 95%
bootstrapped confidence interval crosses 0 - indicating that there is no
evidence indicating that the fairness criterion is violated, but when
assessed by ratio, the interval crosses 1 - which indicates that there
is.</p>
<blockquote>
<p><strong>NOTE:</strong></p>
<p>Statistical inference from bootstrapped confidence intervals should
be interpreted with caution. A confidence interval crossing 0 (for
differences) or 1 (for ratios) means the evidence is inconclusive rather
than proving absence of unfairness. Apparent violations may reflect
sampling variability rather than systematic bias. Always complement
these results with domain knowledge, sensitivity analyses, and
additional fairness diagnostics before drawing strong conclusions about
a specific fairness assesment.</p>
</blockquote>
<p>While <code>fairmetrics</code> focuses only on assessing fairness of
models across binary protected attributes, it is possible to work with
protected attributes which consist of more than two groups by using
“one-vs-all” comparisons and a little bit of data wrangling to create
the appropriate columns.</p>
</div>
<div class="section level2">
<h2 id="conditional-fairness-evaluation">Conditional Fairness Evaluation<a class="anchor" aria-label="anchor" href="#conditional-fairness-evaluation"></a>
</h2>
<p>To evaluate a model’s fairness for a specific subgroup, simply subset
the data. For example, to evaluate the conditional statistical parity
among subjects aged 60 and older using the previously fitted random
forest model, subsetting the test data and and passing it through the
<code>eval_stats_parity</code> is all thats required.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eval_stats_parity.html">eval_stats_parity</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">60</span><span class="op">)</span>, </span>
<span>  outcome <span class="op">=</span> <span class="st">"day_28_flg"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>  probs <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.41</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; There is not enough evidence that the model does not satisfy</span></span>
<span><span class="co">#&gt;             statistical parity.</span></span>
<span><span class="co">#&gt;                     Metric GroupFemale GroupMale Difference 95% Diff CI Ratio</span></span>
<span><span class="co">#&gt; 1 Positive Prediction Rate        0.34      0.25       0.09   [0, 0.18]  1.36</span></span>
<span><span class="co">#&gt;   95% Ratio CI</span></span>
<span><span class="co">#&gt; 1 [1.01, 1.84]</span></span></code></pre></div>
<p>From the bootstrapped confidence intervals for the difference and the
ratio, we note that there is evidence that statistical parity is
violated based on the difference and ratio confidence intervals between
the male and female subjects aged 60 and over. A similar example can be
constructed with <code>get_fairness_metrics</code> for a more
comprehensive view of the conditional fairness of the model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_fairness_metrics.html">get_fairness_metrics</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">60</span><span class="op">)</span>, </span>
<span>  outcome <span class="op">=</span> <span class="st">"day_28_flg"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>  probs <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.41</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;            Fairness Assesment                                  Metric</span></span>
<span><span class="co">#&gt; 1          Statistical Parity                Positive Prediction Rate</span></span>
<span><span class="co">#&gt; 2           Equal Opportunity                     False Negative Rate</span></span>
<span><span class="co">#&gt; 3         Predictive Equality                     False Positive Rate</span></span>
<span><span class="co">#&gt; 4  Balance for Positive Class           Avg. Predicted Positive Prob.</span></span>
<span><span class="co">#&gt; 5  Balance for Negative Class           Avg. Predicted Negative Prob.</span></span>
<span><span class="co">#&gt; 6  Positive Predictive Parity               Positive Predictive Value</span></span>
<span><span class="co">#&gt; 7  Negative Predictive Parity               Negative Predictive Value</span></span>
<span><span class="co">#&gt; 8          Brier Score Parity                             Brier Score</span></span>
<span><span class="co">#&gt; 9     Overall Accuracy Parity                                Accuracy</span></span>
<span><span class="co">#&gt; 10         Treatment Equality (False Negative)/(False Positive) Ratio</span></span>
<span><span class="co">#&gt;    GroupFemale GroupMale Difference   95% Diff CI Ratio 95% Ratio CI</span></span>
<span><span class="co">#&gt; 1         0.34      0.25       0.09  [0.01, 0.17]  1.36 [1.01, 1.83]</span></span>
<span><span class="co">#&gt; 2         0.30      0.46      -0.16    [-0.32, 0]  0.65 [0.41, 1.04]</span></span>
<span><span class="co">#&gt; 3         0.18      0.11       0.07 [-0.01, 0.15]  1.64 [0.91, 2.96]</span></span>
<span><span class="co">#&gt; 4         0.50      0.41       0.09  [0.04, 0.14]  1.22 [1.08, 1.38]</span></span>
<span><span class="co">#&gt; 5         0.26      0.22       0.04  [0.01, 0.07]  1.18 [1.03, 1.36]</span></span>
<span><span class="co">#&gt; 6         0.63      0.69      -0.06  [-0.22, 0.1]  0.91 [0.71, 1.17]</span></span>
<span><span class="co">#&gt; 7         0.86      0.81       0.05 [-0.03, 0.13]  1.06 [0.96, 1.17]</span></span>
<span><span class="co">#&gt; 8         0.14      0.16      -0.02 [-0.05, 0.01]  0.88 [0.71, 1.07]</span></span>
<span><span class="co">#&gt; 9         0.78      0.78       0.00 [-0.08, 0.08]  1.00  [0.91, 1.1]</span></span>
<span><span class="co">#&gt; 10        0.71      1.88      -1.17  [-2.54, 0.2]  0.38 [0.16, 0.89]</span></span></code></pre></div>
<p>Conditioning on subjects aged 60 and older, Statistical Parity,
Balance for Positive Class and Balance for Negative Class posses
evidence for being violated based on 95% bootstrapped confidence
intervals. While Predictive Equality, Positive Predictive Parity,
Negative Predictive Parity, Brier Score Parity and Overall Accuracy
Parity do not. Similar to the unconditioned case, Treatment Equality
remains ambiguous based on the contrast between the difference and ratio
confidence intervals. If difference is considered, there is evidence of
Treatment equality being violated. If ratio is considered, there does
not.</p>
</div>
<div class="section level2">
<h2 id="appendix-confidence-interval-construction">Appendix: Confidence Interval Construction<a class="anchor" aria-label="anchor" href="#appendix-confidence-interval-construction"></a>
</h2>
<p>The function <code><a href="../reference/get_fairness_metrics.html">get_fairness_metrics()</a></code> computes Wald-type
confidence intervals for both group-specific and disparity metrics using
nonparametric bootstrap. To illustrate the construction of confidence
intervals (CIs), we use the following example involving the false
positive rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>P</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">FPR</annotation></semantics></math>).</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><mi>a</mi></msub><annotation encoding="application/x-tex">\widehat{\textrm{FPR}}_a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">FPR</mtext><mi>a</mi></msub><annotation encoding="application/x-tex">\textrm{FPR}_a</annotation></semantics></math>
denote the estimated and true FPR in group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">A = a</annotation></semantics></math>.
Then the difference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>=</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>1</mn></msub></msub><mo>−</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>0</mn></msub></msub></mrow><annotation encoding="application/x-tex">\widehat{\Delta}_{\textrm{FPR}} = \widehat{\textrm{FPR}}_{a_1} - \widehat{\textrm{FPR}}_{a_0}</annotation></semantics></math>
satisfies (e.g., <a href="https://doi.org/10.1093/jrsssb/qkad107" class="external-link">Gronsbell et al.,
2018</a>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mi>n</mi></msqrt><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>−</mo><msub><mi>Δ</mi><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mover><mo>→</mo><mi>d</mi></mover><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\sqrt{n}(\widehat{\Delta}_{\textrm{FPR}} - \Delta_{\textrm{FPR}}) \overset{d}{\to} \mathcal{N}(0, \sigma^2)
</annotation></semantics></math></p>
<p>We estimate the standard error of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><annotation encoding="application/x-tex">\widehat{\Delta}_{\textrm{FPR}}</annotation></semantics></math>
using bootstrap resampling within groups, and form a Wald-style
confidence interval:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>±</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Δ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\widehat{\Delta}_{\textrm{FPR}} \pm z_{1-\alpha/2} \cdot \widehat{\textrm{se}}(\widehat{\Delta}_{\textrm{FPR}})
</annotation></semantics></math></p>
<p>For <strong>ratios</strong>, such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo>=</mo><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>1</mn></msub></msub><mi>/</mi><msub><mover><mtext mathvariant="normal">FPR</mtext><mo accent="true">̂</mo></mover><msub><mi>a</mi><mn>0</mn></msub></msub></mrow><annotation encoding="application/x-tex">\widehat{\rho}_{\textrm{FPR}} = \widehat{\textrm{FPR}}_{a_1} / \widehat{\textrm{FPR}}_{a_0}</annotation></semantics></math>,
we apply a log transformation and use the delta method:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>±</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\log(\widehat{\rho}_{\textrm{FPR}}) \pm z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]
</annotation></semantics></math></p>
<p>Exponentiation of the bounds yields a confidence interval for the
ratio on the original scale:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mover><mtext mathvariant="normal">se</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>ρ</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">FPR</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\left[ 
\exp\left\{\log(\widehat{\rho}_{\textrm{FPR}}) - z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]\right\},\ 
\exp\left\{\log(\widehat{\rho}_{\textrm{FPR}}) + z_{1-\alpha/2} \cdot \widehat{\textrm{se}}\left[\log(\widehat{\rho}_{\textrm{FPR}})\right]\right\}
\right].
</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Raffa, J. (2016). Clinical data from the MIMIC-II database for a
case study on indwelling arterial catheters (version 1.0). PhysioNet. <a href="https://doi.org/10.13026/C2NC7F" class="external-link uri">https://doi.org/10.13026/C2NC7F</a>.</p></li>
<li><p>Raffa J.D., Ghassemi M., Naumann T., Feng M., Hsu D. (2016) Data
Analysis. In: Secondary Analysis of Electronic Health Records. Springer,
Cham</p></li>
<li><p>Goldberger, A., Amaral, L., Glass, L., Hausdorff, J., Ivanov, P.
C., Mark, R., … &amp; Stanley, H. E. (2000). PhysioBank, PhysioToolkit,
and PhysioNet: Components of a new research resource for complex
physiologic signals. Circulation [Online]. 101 (23),
pp. e215–e220.</p></li>
<li><p>Gao, J. et al. What is Fair? Defining Fairness in Machine
Learning for Health. arXiv.org <a href="https://arxiv.org/abs/2406.09307" class="external-link uri">https://arxiv.org/abs/2406.09307</a> (2024).</p></li>
<li><p>Gronsbell, J. L. &amp; Cai, T. Semi-Supervised approaches to
efficient evaluation of model prediction performance. Journal of the
Royal Statistical Society Series B (Statistical Methodology) 80, 579–594
(2017).</p></li>
<li><p>Hort, M., Chen, Z., Zhang, J. M., Harman, M. &amp; Sarro, F. Bias
Mitigation for Machine Learning Classifiers: A Comprehensive survey.
arXiv.org <a href="https://arxiv.org/abs/2207.07068" class="external-link uri">https://arxiv.org/abs/2207.07068</a> (2022).</p></li>
<li><p>Hsu, D. J. et al. The association between indwelling arterial
catheters and mortality in hemodynamically stable patients with
respiratory failure. CHEST Journal 148, 1470–1476 (2015).</p></li>
<li><p>Efron, B. &amp; Tibshirani, R. Bootstrap methods for standard
errors, confidence intervals, and other measures of statistical
accuracy. Statistical Science 1, (1986).</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jianhui Gao, Benjamin Smith, Benson Chou, Jessica Gronsbell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
